
<!doctype html>
<!-- START OF _layouts/default.html -->
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" >
		<meta content="width=device-width,initial-scale=1" name="viewport">
		<meta content="A blog of JavaScript techniques and tutorials" name="description">
		<meta content="JavaScript Without Grammar" name="author">
		
        <link rel='alternate' type='application/atom+xml' title='JavaScript Without Grammar' href='http://browniefed.com/atom.xml'>

		<title>React-Native Animated with React-Art - Firework Tap To Shoot &mdash; JavaScript Without Grammar</title>
		
		<!-- Styles -->
		<link href="/stylesheets/main.css" rel="stylesheet">
		
		<!-- Google webfonts -->
		<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Tangerine">
		<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Cousine">
		
		<!-- jQuery and plugins -->
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
		
		<!-- Syntax highlighter -->
		<link href="/stylesheets/prettify-hemisu.css" type="text/css" rel="stylesheet" />
		<script type="text/javascript" src="/js/prettify.js"></script>
				
	</head>
	<body onload="prettyPrint()">
	
		<div class="wrap">
	
			<header>
				<div class="title"><a href="/">JavaScript Without Grammar</a></div>
								
								<div class="navi">
									<ul>
										<li><a href="/">Blog</a></li>
										<li><a href="/blog/archives">Archives</a></li>
										<li><a href="/about">About</a></li>
										<li><a href="http://github.com/browniefed">Github</a></li>
										<li><a href="http://twitter.com/browniefed">Twitter</a></li>
										<li><a href="mailto:browniefed@gmail.com">Email</a></li>
									<ul>
								</div> <!-- // .navi -->
			</header>
		
				<!-- START OF _layouts/post.html -->

<!-- START OF _includes/article.html -->
<article>
	<header>
		<h1><a href="/blog/2015/08/29/react-native-animated-with-react-art-firework-show/">React-Native Animated with React-Art - Firework Tap To Shoot</a></h1>
		<time>29 August 2015</time>
	</header>
	<div class="content">
		
            <div class="entry-content"><h1>Introduction</h1>

<p>This actually could be built with out react-art, but we&rsquo;ll use react-art just for good measure.
What are we building? A firework show. Nothing fancy. Just tap on the screen and a firework will be shot to that point and explode.</p>

<h1>What?</h1>

<p>This is what we&rsquo;re building</p>

<p><img src="http://i.imgur.com/Dj60a6e.gif" title="Firework Shooter" ></p>

<!-- more -->


<h1>Setup</h1>

<p>Just like normal, lets set the scene. A blank app with everything imported, etc.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var React = require('react-native');
</span><span class='line'>var Dimensions = require('Dimensions');
</span><span class='line'>var ReactNativeART = require('ReactNativeART');
</span><span class='line'>
</span><span class='line'>var {
</span><span class='line'>  width,
</span><span class='line'>  height
</span><span class='line'>} = Dimensions.get('window');
</span><span class='line'>
</span><span class='line'>var {
</span><span class='line'>  AppRegistry,
</span><span class='line'>  StyleSheet,
</span><span class='line'>  Animated,
</span><span class='line'>  View,
</span><span class='line'>  TouchableWithoutFeedback
</span><span class='line'>} = React;
</span><span class='line'>
</span><span class='line'>var {
</span><span class='line'>    Surface,
</span><span class='line'>    Shape,
</span><span class='line'>    Path,
</span><span class='line'>    Group,
</span><span class='line'>    Transform
</span><span class='line'>} = ReactNativeART;
</span><span class='line'>
</span><span class='line'>var AnimatedShape = Animated.createAnimatedComponent(Shape);
</span><span class='line'>var AnimatedGroup = Animated.createAnimatedComponent(Group);</span></code></pre></td></tr></table></div></figure>


<p>We bring in the <code>Animated</code> API, <code>ReactNativeART</code>, some components from <code>ART</code>.
The thing that we have done before is creating <code>AnimatedShape</code>, and <code>AnimatedGroup</code>. What these do is allow us to set props like <code>fill</code>, <code>opacity</code>, <code>x</code>, <code>y</code>, that are Animated values. This will cause updates in our native world correctly and efficiently.</p>

<p>Now our styles</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var styles = StyleSheet.create({
</span><span class='line'>  container: {
</span><span class='line'>    flex: 1,
</span><span class='line'>    flexDirection: 'column'
</span><span class='line'>  }
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<p>Yep that is it. Most of our stuff will take place in the <code>react-art</code> world.</p>

<p>Now our basic class</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var FireworkShooter = React.createClass({
</span><span class='line'>  getInitialState: function() {
</span><span class='line'>    return {
</span><span class='line'>      fireworks: []
</span><span class='line'>    };
</span><span class='line'>  },
</span><span class='line'>  render: function() {
</span><span class='line'>    return (
</span><span class='line'>      &lt;View style={styles.container}&gt;
</span><span class='line'>        &lt;TouchableWithoutFeedback&gt;
</span><span class='line'>          &lt;View&gt;
</span><span class='line'>            &lt;Surface width={width} height={height}&gt;
</span><span class='line'>            &lt;/Surface&gt;
</span><span class='line'>          &lt;/View&gt;
</span><span class='line'>        &lt;/TouchableWithoutFeedback&gt;
</span><span class='line'>      &lt;/View&gt;
</span><span class='line'>    );
</span><span class='line'>  }
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<p>So we have a simple setup. A full container view, with a <code>TouchableWithoutFeedback</code> so we can get the press coordinates. Then a wrapping <code>View</code> since <code>Touchable</code> stuff needs a native view below it. Then finally our <code>react-art</code> <code>Surface</code>. This takes a <code>width</code> and <code>height</code> prop. In our case we want the full screen, so we get the dimensions of the phone that we extracted up above and set it.</p>

<h1>Shoot a mortar</h1>

<p>Lets think about this.
We want a mortar (a small glowing ball) to shoot from the bottom center of the screen to where we&rsquo;ve tapped.</p>

<p>That means with <code>react-art</code> we&rsquo;ll have to create a closed <code>Path</code> that is a circle. It just so happens that <code>react-art</code> ships with a <code>Circle</code> shape for us to use.</p>

<p>Okay so our list of needs</p>

<ul>
<li>A press handler to get where we tapped</li>
<li>A <code>Circle</code> that can take Animated API props</li>
<li>A way to animate that <code>Circle</code> aka mortar to the tap</li>
<li>Render a mortar on the <code>Surface</code></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;TouchableWithoutFeedback onPress={this._handleAddFirework}&gt;</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ll use the <code>TouchableWithoutFeedback</code> to call out to a function to queue up adding a firework.
Check that off the list.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//React-Art ships with this component however not react-native-art implementation we'll just grab it and
</span><span class='line'>//modify this to use the AnimatedShape we create up above. Thanks Facebook :)
</span><span class='line'>
</span><span class='line'>/**
</span><span class='line'> * Copyright 2013-2014 Facebook, Inc.
</span><span class='line'> * All rights reserved.
</span><span class='line'> *
</span><span class='line'> * This source code is licensed under the BSD-style license found in the
</span><span class='line'> * LICENSE file in the root directory of this source tree. An additional grant
</span><span class='line'> * of patent rights can be found in the PATENTS file in the same directory.
</span><span class='line'> *
</span><span class='line'> * @providesModule Circle.art
</span><span class='line'> * @typechecks
</span><span class='line'> *
</span><span class='line'> * Example usage:
</span><span class='line'> * &lt;Circle
</span><span class='line'> *   radius={10}
</span><span class='line'> *   stroke="green"
</span><span class='line'> *   strokeWidth={3}
</span><span class='line'> *   fill="blue"
</span><span class='line'> * /&gt;
</span><span class='line'> *
</span><span class='line'> */
</span><span class='line'>var AnimatedCircle = React.createClass({displayName: "Circle",
</span><span class='line'>  render: function() {
</span><span class='line'>    var radius = this.props.radius;
</span><span class='line'>
</span><span class='line'>    var path = Path().moveTo(0, -radius)
</span><span class='line'>        .arc(0, radius * 2, radius)
</span><span class='line'>        .arc(0, radius * -2, radius)
</span><span class='line'>        .close();
</span><span class='line'>    return React.createElement(AnimatedShape, React.__spread({},  this.props, {d: path}));
</span><span class='line'>  }
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<p>Hey look we just grabbed it and changed <code>Shape</code> to <code>AnimatedShape</code>. Yaye for React and reusable code.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var MORTAR_RADIUS = 5;
</span><span class='line'>///...
</span><span class='line'>_handleAddFirework: function(e) {
</span><span class='line'>    var _shootingPosition = new Animated.ValueXY({x: width/2, y: height - MORTAR_RADIUS});
</span><span class='line'>
</span><span class='line'>    this.state.fireworks.push({
</span><span class='line'>      shootingPosition: _shootingPosition,
</span><span class='line'>    });
</span><span class='line'>
</span><span class='line'>    Animated.timing(_shootingPosition, {
</span><span class='line'>        duration: 300,
</span><span class='line'>        toValue: {
</span><span class='line'>          y: e.nativeEvent.locationY,
</span><span class='line'>          x: e.nativeEvent.locationX
</span><span class='line'>        }
</span><span class='line'>    }).start()
</span><span class='line'>    
</span><span class='line'>    this.setState(this.state);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Alright. Pause and lets analyze this code.</p>

<p>First line <code>_shootingPosition</code>, we create a new <code>Animated.ValueXY</code> and set our defaults. These defaults are the starting position of the animation. Usually these would default to <code>x: 0, y:0</code> but we have other plans.</p>

<p>We set our <code>x</code> to <code>width/2</code> which is the middle of the phone. Then our <code>y</code> is going to the <code>height</code> of the device minus a <code>MORTAR_RADIUS</code>. We put a constant at the top of the code to say our mortar radius is going to be 5.</p>

<p>Next we add it to an array of fireworks we&rsquo;ll shoot later.</p>

<p>Then we create the animation.
We want the mortar to take <code>300</code> milliseconds to reach the spot the user pressed. We set the <code>toValue</code> to where our users pressed.
Then we start the animation. Yeah we haven&rsquo;t even rendered anything yet but it&rsquo;ll all be okay trust me.</p>

<p>Finally we set our state and thus it&rsquo;ll cause a re-render and we can render our firework.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;Surface width={width} height={height}&gt;
</span><span class='line'>{
</span><span class='line'>    this.state.fireworks.map((firework) =&gt; {
</span><span class='line'>        return &lt;AnimatedCircle 
</span><span class='line'>                    radius={MORTAR_RADIUS} 
</span><span class='line'>                    x={firework.shootingPosition.x} 
</span><span class='line'>                    y={firework.shootingPosition.y}
</span><span class='line'>                    fill="#000"
</span><span class='line'>                /&gt;
</span><span class='line'>    })
</span><span class='line'>}
</span><span class='line'>&lt;/Surface&gt;</span></code></pre></td></tr></table></div></figure>


<p>So we map over each firework, return the <code>AnimatedCircle</code> and set the appropriate properties, which 2 of those <code>x</code>, and <code>y</code> are animated properties. In our case we&rsquo;re going to fill the cirlcle with black to start.</p>

<p>So what does that all look like? Something like this</p>

<p><img src="http://i.imgur.com/arIjyoz.gif" title="Black Shooting Circles" ></p>

<h1>Shoot multiple mortars that disappear</h1>

<p>Well mortars don&rsquo;t stick like that. So lets make them disappear.
The <code>start()</code> function takes a callback that is called when the animation completes.</p>

<p>To identify the firework in the array we&rsquo;ll just use the <code>shootingPosition</code> animation to identify it and filter it out.</p>

<p>Something like this.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  removeSelf: function(_shootingPosition) {
</span><span class='line'>    this.state.fireworks = this.state.fireworks.filter((firework) =&gt; firework.shootingPosition !== _shootingPosition);
</span><span class='line'>    this.setState(this.state);
</span><span class='line'>  },
</span><span class='line'>
</span><span class='line'>  ///
</span><span class='line'>    Animated.timing(_shootingPosition, {
</span><span class='line'>        duration: 300,
</span><span class='line'>        toValue: {
</span><span class='line'>          y: e.nativeEvent.locationY,
</span><span class='line'>          x: e.nativeEvent.locationX
</span><span class='line'>        }
</span><span class='line'>    ]).start(this.removeSelf.bind(this, _shootingPosition));</span></code></pre></td></tr></table></div></figure>


<p>Not the most elegant of solutions but hey it works. It runs through each firework, removes our _shootingPosition, and then refreshes the UI.</p>

<h1>Animate the color</h1>

<p>Lets make the mortar more than just a black dot. Lets pretend it&rsquo;s a fire ball, and we want it to alternate between yellow and orange.</p>

<p>We&rsquo;ll use these 2 colors and pop them at the top</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var SHOOTING_COLORS = [
</span><span class='line'>  'rgb(234,238,112)', //Yellow
</span><span class='line'>  'rgb(245,137,12)' //Orange
</span><span class='line'>];</span></code></pre></td></tr></table></div></figure>


<p>The <code>interpolate</code> function we&rsquo;re going to call only works with <code>rgb</code> hence the use of <code>rgb</code> instead of hex.</p>

<p>Next we&rsquo;ll need to create another Animated value.</p>

<p>Our code will look like so</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var _shootingPosition = new Animated.ValueXY({x: width/2, y: height - MORTAR_RADIUS});
</span><span class='line'>var _shootingColor = new Animated.Value(0);
</span><span class='line'>
</span><span class='line'>this.state.fireworks.push({
</span><span class='line'>  shootingPosition: _shootingPosition,
</span><span class='line'>  shootingColor: _shootingColor,
</span><span class='line'>});
</span><span class='line'>
</span><span class='line'>//
</span><span class='line'>
</span><span class='line'>_shootingPosition.addListener(this.adjustShootingFill.bind(null, _shootingColor));
</span><span class='line'>  
</span><span class='line'>adjustShootingFill: function(_shootingColor, value) {
</span><span class='line'>    Animated.timing(_shootingColor, {
</span><span class='line'>      duration: 16,
</span><span class='line'>      toValue: _shootingColor.getAnimatedValue() == 0 ? 1 : 0
</span><span class='line'>    }).start()
</span><span class='line'>},
</span></code></pre></td></tr></table></div></figure>


<p>We start off by adding a new <code>Animated.Value</code>, and set it to 0. We add it to our firework object.</p>

<p>Then we add a listener to it. What <code>addListener</code> does is provides a callback that will be called each time the mortar position is updated.
The bind is just so it&rsquo;ll pass in our <code>_shootingColor</code> Animated value as the first argument.</p>

<p>We&rsquo;ll use the <code>Animated.timing</code> function again to transition it between colors over 16ms. We call <code>getAnimatedValue()</code> and do the inverse of it.</p>

<p>So every <code>16ms</code> the mortar will transition from yellow => orange => yellow => orange, etc.</p>

<p>Now what does that look like in our render?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;Surface width={width} height={height}&gt;
</span><span class='line'>{
</span><span class='line'>    this.state.fireworks.map((firework) =&gt; {
</span><span class='line'>        
</span><span class='line'>        var _shootingFill = firework.shootingColor.interpolate({
</span><span class='line'>          inputRange: [0,1],
</span><span class='line'>          outputRange: SHOOTING_COLORS
</span><span class='line'>        });
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>        return &lt;AnimatedCircle 
</span><span class='line'>                    radius={MORTAR_RADIUS} 
</span><span class='line'>                    x={firework.shootingPosition.x} 
</span><span class='line'>                    y={firework.shootingPosition.y}
</span><span class='line'>                    fill={_shootingFill}
</span><span class='line'>                /&gt;
</span><span class='line'>    })
</span><span class='line'>}
</span><span class='line'>&lt;/Surface&gt;</span></code></pre></td></tr></table></div></figure>


<p>We need to create an interpolator. This interpolate will encapsulate the logic that picks the color when we change the value of <code>shootingColor</code> up above in our <code>adjustShootingFill</code> function.</p>

<p>It maps to</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0 =&gt; yellow
</span><span class='line'>1 =&gt; orange</span></code></pre></td></tr></table></div></figure>


<p>Then we pass that into our fill property and we&rsquo;re done.</p>

<p><img src="http://i.imgur.com/r69Ba6r.gif" title="Orange Yellow Moratrs" ></p>

<h1>Make those mortars explode</h1>

<p>Now for the fun part. Lets make our mortars explode.</p>

<p>Our mortar concept will be pretty simplistic, we&rsquo;ll create 20 circles that explode outwards and expand.
We could create all sorts of tails that fly around and do cool things but that is a tutorial for another time.</p>

<p>First lets setup some variables</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var PARTICLE_RADIUS = 30; // How big should the explosions be
</span><span class='line'>var PARTICLE_COUNT = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]; // How many particles per explosion, this is the lazy persons range call
</span><span class='line'>
</span><span class='line'>var PARTICLE_COLORS = [
</span><span class='line'>    'rgba(54, 17, 52, 100)',
</span><span class='line'>    'rgba(176, 34, 140, 100)',
</span><span class='line'>    'rgba(234, 55, 136, 100)',
</span><span class='line'>    'rgba(229, 107, 112, 100)',
</span><span class='line'>    'rgba(243, 145, 160, 100)'
</span><span class='line'>]</span></code></pre></td></tr></table></div></figure>


<p>We the <code>PARTICLE_RADIUS</code> which will determine how large each explosion is. We setup <code>PARTICLE_COUNT</code> which is the amount of particles we&rsquo;ll use.
Finally we want our firework show to be 5 different colors. So each explosion will change between each of these colors.</p>

<p>For the sake of simplicity we&rsquo;ll make each particle the same exact color meaning we only need 1 <code>Animated.Value</code> for it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var _particleColor = new Animated.Value(0);
</span><span class='line'>var _particleRadius = new Animated.Value(0);
</span><span class='line'>var _coreOpacity = new Animated.Value(1);
</span></code></pre></td></tr></table></div></figure>


<p>We also need an <code>Animated.Value</code> for our radius, we put it at 0 so it starts hidden. The other <code>Animated.Value</code> is our core opacity animation.
That is the value for hiding our core mortar once it explodes.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var _particlePositions = PARTICLE_COUNT.map(() =&gt; new Animated.ValueXY({x: 0, y: 0}));</span></code></pre></td></tr></table></div></figure>


<p>Each particle will have to go to a different position so in this case we&rsquo;ll need 20 <code>Animated.ValueXY</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>this.state.fireworks.push({
</span><span class='line'>      shootingPosition: _shootingPosition,
</span><span class='line'>      shootingColor: _shootingColor,
</span><span class='line'>      particleColor: _particleColor,
</span><span class='line'>      particleRadius: _particleRadius,
</span><span class='line'>      coreOpacity: _coreOpacity,
</span><span class='line'>      particlePositions: _particlePositions
</span><span class='line'>    });</span></code></pre></td></tr></table></div></figure>


<p>Add them to our firework so we can access them later in our render.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var _animatedParticles = [
</span><span class='line'>    Animated.timing(_particleRadius, {
</span><span class='line'>      duration: 700,
</span><span class='line'>      toValue: 1
</span><span class='line'>    }),
</span><span class='line'>    Animated.timing(_coreOpacity, {
</span><span class='line'>      duration: 200,
</span><span class='line'>      toValue: 0
</span><span class='line'>    })
</span><span class='line'>]
</span><span class='line'>
</span><span class='line'>_movingParticles = _particlePositions.map((particle, i) =&gt; {
</span><span class='line'>  var _xy = getXYParticle(PARTICLE_COUNT.length, i, PARTICLE_RADIUS);
</span><span class='line'>  return Animated.timing(particle, {
</span><span class='line'>    duration: 250,
</span><span class='line'>    toValue: _xy
</span><span class='line'>  })
</span><span class='line'>})
</span><span class='line'>
</span><span class='line'>//At the bottom of the file
</span><span class='line'>function getXYParticle(total, i, radius) {
</span><span class='line'>  var angle = 360/total*i;
</span><span class='line'>
</span><span class='line'>  var x = Math.round((radius*2) * Math.cos(angle - (Math.PI/2)));
</span><span class='line'>  var y = Math.round((radius*2) * Math.sin(angle - (Math.PI/2)));
</span><span class='line'>
</span><span class='line'>  return {
</span><span class='line'>    x: x,
</span><span class='line'>    y: y
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>_animatedParticles = _animatedParticles.concat(_movingParticles);</span></code></pre></td></tr></table></div></figure>


<p>This whole animation mapping is setting us up for what we are going to do next. Which is queue up our animations.</p>

<p>We create an array of animations that need to happen. The first is expanding each <code>_particleRadius</code>. We have determine that it will take 700 milliseconds to fully expand the explosion. The <code>_particleRadius</code> will actually be the particle scale. We&rsquo;ll just scale up the circle so it looks like it&rsquo;s exploding outwards, but that will be shown off in our render function.</p>

<p>We set our <code>_coreOpacity</code> aka our mortar ball to fade out and disappear over 200 milliseconds.</p>

<p>We need to create the animations for each particle. It needs to shoot out from our current mortar location to different points on the circle.
After googling around I found a function below, and deleted a bunch of stuff to basically get down to a rough position algorithim to return <code>x,y</code> positions.</p>

<p>We once again use <code>Animated.timing</code> to say that the particle should take 250 milliseconds to get into it&rsquo;s position.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Animated.sequence([
</span><span class='line'>  Animated.timing(_shootingPosition, {
</span><span class='line'>    duration: 300,
</span><span class='line'>    toValue: {
</span><span class='line'>      y: e.nativeEvent.locationY,
</span><span class='line'>      x: e.nativeEvent.locationX
</span><span class='line'>    }
</span><span class='line'>  }),
</span><span class='line'>  Animated.parallel(_animatedParticles)
</span><span class='line'>]).start(this.removeSelf.bind(this, _shootingPosition));</span></code></pre></td></tr></table></div></figure>


<p>Now to queue up our animations. We want our mortar shooting to happen first, then the explosion.
We do that using <code>Animated.sequence</code>.</p>

<p>We first have our mortar go up to the location of the users touch.
The next piece is wrapping all of our explosion animations in an <code>Animated.parallel</code>. This is the opposite of sequence, which it says execute all of these animations at the same time.</p>

<p>So our mortar fading out and disappearing, our particles expanding, changing color, and exploding outward will all happen at the same time.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>_shootingPosition.addListener(this.adjustShootingFill.bind(null, _shootingColor));
</span><span class='line'>_particleRadius.addListener(this.adjustParticleFill.bind(null, _particleColor));
</span><span class='line'>
</span><span class='line'>///
</span><span class='line'>  adjustParticleFill: function(_particleColor, value) {
</span><span class='line'>    var _currentFill = _particleColor.getAnimatedValue(),
</span><span class='line'>        _particleFill = _currentFill === 5 ? 0 : _currentFill + 1;
</span><span class='line'>
</span><span class='line'>    Animated.timing(_particleColor, {
</span><span class='line'>      duration: 16,
</span><span class='line'>      toValue: _particleFill
</span><span class='line'>    }).start()
</span><span class='line'>  },</span></code></pre></td></tr></table></div></figure>


<p>Finally we need to change our color of our particle. So like before we&rsquo;ll attach to the expanding of our particle and make it call a function to change the fill color.
In our new case we have five colors to choose from so the logic is a little different but mostly the same.</p>

<p>Now for our rendering of this all. We&rsquo;ll move it out to a different function to deal with.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  &lt;Surface width={width} height={height}&gt;
</span><span class='line'>    {this.getFireworks()}
</span><span class='line'>  &lt;/Surface&gt;</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>getFireworks: function() {
</span><span class='line'>    return this.state.fireworks.map((firework, i) =&gt; {
</span><span class='line'>
</span><span class='line'>      var _shootingFill = firework.shootingColor.interpolate({
</span><span class='line'>        inputRange: [0,1],
</span><span class='line'>        outputRange: SHOOTING_COLORS
</span><span class='line'>      });
</span><span class='line'>
</span><span class='line'>      var _particleFill = firework.particleColor.interpolate({
</span><span class='line'>        inputRange: [0,1,2,3,4],
</span><span class='line'>        outputRange: PARTICLE_COLORS
</span><span class='line'>      });
</span><span class='line'>
</span><span class='line'>      return (
</span><span class='line'>          &lt;AnimatedGroup 
</span><span class='line'>            x={firework.shootingPosition.x}
</span><span class='line'>            y={firework.shootingPosition.y}
</span><span class='line'>          &gt;
</span><span class='line'>                &lt;AnimatedCircle
</span><span class='line'>                  opacity={firework.coreOpacity}
</span><span class='line'>                  radius={MORTAR_RADIUS}
</span><span class='line'>                  fill={_shootingFill}
</span><span class='line'>                /&gt;
</span><span class='line'>                &lt;Group&gt;
</span><span class='line'>                {
</span><span class='line'>                  PARTICLE_COUNT.map((v, j) =&gt; {
</span><span class='line'>                    return &lt;AnimatedCircle
</span><span class='line'>                      x={firework.particlePositions[j].x}
</span><span class='line'>                      y={firework.particlePositions[j].y}
</span><span class='line'>                      scaleX={firework.particleRadius}
</span><span class='line'>                      scaleY={firework.particleRadius}
</span><span class='line'>                      radius={PARTICLE_RADIUS}
</span><span class='line'>                      fill={_particleFill}
</span><span class='line'>                    /&gt;
</span><span class='line'>                  })
</span><span class='line'>                }
</span><span class='line'>                &lt;/Group&gt;
</span><span class='line'>          &lt;/AnimatedGroup&gt;
</span><span class='line'>      );
</span><span class='line'>    })
</span><span class='line'>  },</span></code></pre></td></tr></table></div></figure>


<p>There is a lot going on here. We have our same <code>_shootingFill</code> like we did before, that causes the yellow => orange interpolation.
We add another interpolation for the particleFill. Same concept as the <code>_shootingFill</code> just with 5 colors now.</p>

<p>What is much different here is the <code>AnimatedGroup</code>. We have moved our <code>x,y</code> from the <code>AnimatedCircle</code> to the <code>AnimatedGroup</code>.</p>

<p>This will bundle our mortar, and our particles all in the same coordinate area. That way we can have our particles start at <code>0,0</code> and move outwards and the <code>AnimatedGroup</code> will make sure all the coordinates are handled correctly.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;AnimatedCircle
</span><span class='line'>  opacity={firework.coreOpacity}
</span><span class='line'>  radius={MORTAR_RADIUS}
</span><span class='line'>  fill={_shootingFill}
</span><span class='line'>/&gt;</span></code></pre></td></tr></table></div></figure>


<p>You can see here we put out <code>coreOpacity</code> animation in there. So it&rsquo;ll fade from <code>1</code> opacity down to <code>0</code> over that 200 milliseconds we setup.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  &lt;Group&gt;
</span><span class='line'>    {
</span><span class='line'>      PARTICLE_COUNT.map((v, j) =&gt; {
</span><span class='line'>        return &lt;AnimatedCircle
</span><span class='line'>          x={firework.particlePositions[j].x}
</span><span class='line'>          y={firework.particlePositions[j].y}
</span><span class='line'>          scaleX={firework.particleRadius}
</span><span class='line'>          scaleY={firework.particleRadius}
</span><span class='line'>          radius={PARTICLE_RADIUS}
</span><span class='line'>          fill={_particleFill}
</span><span class='line'>        /&gt;
</span><span class='line'>      })
</span><span class='line'>    }
</span><span class='line'>  &lt;/Group&gt;</span></code></pre></td></tr></table></div></figure>


<p>We group the Particles with a <code>Group</code> component but that&rsquo;s just arbitrary.</p>

<p>We map over our 20 particles, and set the <code>x</code> and <code>y</code> to the points we had determined with our <code>getXYParticle</code> function.</p>

<p>You&rsquo;ll notice we are passing in <code>particleRadius</code> to the <code>scaleX</code> and <code>scaleY</code> properties.
This is because while writing this I realized that the <code>AnimatedCircle</code> takes the radius property and creates a path out of it. That is not animateable in this particular way, so the solution I came up was to scale each particle to 0. Basically making it completely hidden.</p>

<p>That then allows us to expand it out to it&rsquo;s full scale and make it look like an explosion. It actually works better.</p>

<p>Finally we add in our <code>PARTICLE_RADIUS</code> we defined at the top, aka size of each explosion, and put in our <code>_particleFill</code> which is the color interpolation between those 5 colors.</p>

<h1>Play with it</h1>

<p>That is all! We have a firework shooter!</p>

<p>Check it out on RNPlay as per usual <a href="https://rnplay.org/apps/ysm12A">https://rnplay.org/apps/ysm12A</a>.</p>

<p>Tap to your hearts content and watch all the explosive animation goodness appear on screen.</p>

<p><img src="http://i.imgur.com/Dj60a6e.gif" title="Firework Shooter" ></p>

<h1>Final Code</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var React = require('react-native');
</span><span class='line'>var Dimensions = require('Dimensions');
</span><span class='line'>var ReactNativeART = require('ReactNativeART');
</span><span class='line'>
</span><span class='line'>var {
</span><span class='line'>  width,
</span><span class='line'>  height
</span><span class='line'>} = Dimensions.get('window');
</span><span class='line'>
</span><span class='line'>var MORTAR_RADIUS = 5;
</span><span class='line'>var PARTICLE_RADIUS = 30;
</span><span class='line'>var PARTICLE_COUNT = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20];
</span><span class='line'>
</span><span class='line'>var {
</span><span class='line'>  AppRegistry,
</span><span class='line'>  StyleSheet,
</span><span class='line'>  Animated,
</span><span class='line'>  View,
</span><span class='line'>  TouchableWithoutFeedback
</span><span class='line'>} = React;
</span><span class='line'>
</span><span class='line'>var {
</span><span class='line'>    Surface,
</span><span class='line'>    Shape,
</span><span class='line'>    Path,
</span><span class='line'>    Group,
</span><span class='line'>    Transform
</span><span class='line'>} = ReactNativeART;
</span><span class='line'>
</span><span class='line'>var SHOOTING_COLORS = [
</span><span class='line'>  'rgb(234,238,112)',
</span><span class='line'>  'rgb(245,137,12)'
</span><span class='line'>];
</span><span class='line'>
</span><span class='line'>var PARTICLE_COLORS = [
</span><span class='line'>    'rgba(54, 17, 52, 100)',
</span><span class='line'>    'rgba(176, 34, 140, 100)',
</span><span class='line'>    'rgba(234, 55, 136, 100)',
</span><span class='line'>    'rgba(229, 107, 112, 100)',
</span><span class='line'>    'rgba(243, 145, 160, 100)'
</span><span class='line'>]
</span><span class='line'>
</span><span class='line'>var AnimatedShape = Animated.createAnimatedComponent(Shape);
</span><span class='line'>var AnimatedGroup = Animated.createAnimatedComponent(Group);
</span><span class='line'>
</span><span class='line'>var FireworkShooter = React.createClass({
</span><span class='line'>  getInitialState: function() {
</span><span class='line'>    return {
</span><span class='line'>      fireworks: []
</span><span class='line'>    };
</span><span class='line'>  },
</span><span class='line'>  adjustShootingFill: function(_shootingColor, value) {
</span><span class='line'>    Animated.timing(_shootingColor, {
</span><span class='line'>      duration: 16,
</span><span class='line'>      toValue: _shootingColor.getAnimatedValue() == 0 ? 1 : 0
</span><span class='line'>    }).start()
</span><span class='line'>  },
</span><span class='line'>  adjustParticleFill: function(_particleColor, value) {
</span><span class='line'>    var _currentFill = _particleColor.getAnimatedValue(),
</span><span class='line'>        _particleFill = _currentFill === 5 ? 0 : _currentFill + 1;
</span><span class='line'>
</span><span class='line'>    Animated.timing(_particleColor, {
</span><span class='line'>      duration: 16,
</span><span class='line'>      toValue: _particleFill
</span><span class='line'>    }).start()
</span><span class='line'>  },
</span><span class='line'>  removeSelf: function(_shootingPosition) {
</span><span class='line'>    this.state.fireworks = this.state.fireworks.filter((firework) =&gt; firework.shootingPosition !== _shootingPosition);
</span><span class='line'>    this.setState(this.state);
</span><span class='line'>  },
</span><span class='line'>  _handleAddFirework: function(e) {
</span><span class='line'>    var _shootingPosition = new Animated.ValueXY({x: width/2, y: height - MORTAR_RADIUS});
</span><span class='line'>    var _shootingColor = new Animated.Value(0);
</span><span class='line'>
</span><span class='line'>    var _particleColor = new Animated.Value(0);
</span><span class='line'>    var _particleRadius = new Animated.Value(0);
</span><span class='line'>    var _coreOpacity = new Animated.Value(1);
</span><span class='line'>
</span><span class='line'>    var _particlePositions = PARTICLE_COUNT.map(() =&gt; new Animated.ValueXY({x: 0, y: 0}));
</span><span class='line'>
</span><span class='line'>    this.state.fireworks.push({
</span><span class='line'>      shootingPosition: _shootingPosition,
</span><span class='line'>      shootingColor: _shootingColor,
</span><span class='line'>      particleColor: _particleColor,
</span><span class='line'>      particleRadius: _particleRadius,
</span><span class='line'>      coreOpacity: _coreOpacity,
</span><span class='line'>      particlePositions: _particlePositions
</span><span class='line'>    });
</span><span class='line'>
</span><span class='line'>    var _animatedParticles = [
</span><span class='line'>        Animated.timing(_particleRadius, {
</span><span class='line'>          duration: 700,
</span><span class='line'>          toValue: 1
</span><span class='line'>        }),
</span><span class='line'>        Animated.timing(_coreOpacity, {
</span><span class='line'>          duration: 200,
</span><span class='line'>          toValue: 0
</span><span class='line'>        })
</span><span class='line'>    ]
</span><span class='line'>
</span><span class='line'>    _movingParticles = _particlePositions.map((particle, i) =&gt; {
</span><span class='line'>      var _xy = getXYParticle(PARTICLE_COUNT.length, i, PARTICLE_RADIUS);
</span><span class='line'>      return Animated.timing(particle, {
</span><span class='line'>        duration: 250,
</span><span class='line'>        toValue: _xy
</span><span class='line'>      })
</span><span class='line'>    })
</span><span class='line'>
</span><span class='line'>    _animatedParticles = _animatedParticles.concat(_movingParticles);
</span><span class='line'>
</span><span class='line'>    Animated.sequence([
</span><span class='line'>      Animated.timing(_shootingPosition, {
</span><span class='line'>        duration: 300,
</span><span class='line'>        toValue: {
</span><span class='line'>          y: e.nativeEvent.locationY,
</span><span class='line'>          x: e.nativeEvent.locationX
</span><span class='line'>        }
</span><span class='line'>      }),
</span><span class='line'>      Animated.parallel(_animatedParticles)
</span><span class='line'>    ]).start(this.removeSelf.bind(this, _shootingPosition));
</span><span class='line'>
</span><span class='line'>    _shootingPosition.addListener(this.adjustShootingFill.bind(null, _shootingColor));
</span><span class='line'>    _particleRadius.addListener(this.adjustParticleFill.bind(null, _particleColor));
</span><span class='line'>
</span><span class='line'>    this.setState(this.state);
</span><span class='line'>  },
</span><span class='line'>
</span><span class='line'>  getFireworks: function() {
</span><span class='line'>    return this.state.fireworks.map((firework, i) =&gt; {
</span><span class='line'>
</span><span class='line'>      var _shootingFill = firework.shootingColor.interpolate({
</span><span class='line'>        inputRange: [0,1],
</span><span class='line'>        outputRange: SHOOTING_COLORS
</span><span class='line'>      });
</span><span class='line'>
</span><span class='line'>      var _particleFill = firework.particleColor.interpolate({
</span><span class='line'>        inputRange: [0,1,2,3,4],
</span><span class='line'>        outputRange: PARTICLE_COLORS
</span><span class='line'>      });
</span><span class='line'>
</span><span class='line'>      return (
</span><span class='line'>          &lt;AnimatedGroup 
</span><span class='line'>            x={firework.shootingPosition.x}
</span><span class='line'>            y={firework.shootingPosition.y}
</span><span class='line'>          &gt;
</span><span class='line'>                &lt;AnimatedCircle
</span><span class='line'>                  key={i}
</span><span class='line'>                  opacity={firework.coreOpacity}
</span><span class='line'>                  radius={MORTAR_RADIUS}
</span><span class='line'>                  fill={_shootingFill}
</span><span class='line'>                /&gt;
</span><span class='line'>                &lt;Group&gt;
</span><span class='line'>                {
</span><span class='line'>                  PARTICLE_COUNT.map((v, j) =&gt; {
</span><span class='line'>                    return &lt;AnimatedCircle
</span><span class='line'>                      x={firework.particlePositions[j].x}
</span><span class='line'>                      y={firework.particlePositions[j].y}
</span><span class='line'>                      scaleX={firework.particleRadius}
</span><span class='line'>                      scaleY={firework.particleRadius}
</span><span class='line'>                      radius={PARTICLE_RADIUS}
</span><span class='line'>                      fill={_particleFill}
</span><span class='line'>                    /&gt;
</span><span class='line'>                  })
</span><span class='line'>                }
</span><span class='line'>                &lt;/Group&gt;
</span><span class='line'>          &lt;/AnimatedGroup&gt;
</span><span class='line'>      );
</span><span class='line'>    })
</span><span class='line'>  },
</span><span class='line'>  render: function() {
</span><span class='line'>    return (
</span><span class='line'>      &lt;View style={styles.container}&gt;
</span><span class='line'>        &lt;TouchableWithoutFeedback onPress={this._handleAddFirework}&gt;
</span><span class='line'>          &lt;View&gt;
</span><span class='line'>            &lt;Surface width={width} height={height}&gt;
</span><span class='line'>              {this.getFireworks()}
</span><span class='line'>            &lt;/Surface&gt;
</span><span class='line'>          &lt;/View&gt;
</span><span class='line'>        &lt;/TouchableWithoutFeedback&gt;
</span><span class='line'>      &lt;/View&gt;
</span><span class='line'>    );
</span><span class='line'>  }
</span><span class='line'>});
</span><span class='line'>
</span><span class='line'>var styles = StyleSheet.create({
</span><span class='line'>  container: {
</span><span class='line'>    flex: 1,
</span><span class='line'>    flexDirection: 'column'
</span><span class='line'>  }
</span><span class='line'>});
</span><span class='line'>
</span><span class='line'>function getXYParticle(total, i, radius) {
</span><span class='line'>  var angle = 360/total*i;
</span><span class='line'>
</span><span class='line'>  var x = Math.round((radius*2) * Math.cos(angle - (Math.PI/2)));
</span><span class='line'>  var y = Math.round((radius*2) * Math.sin(angle - (Math.PI/2)));
</span><span class='line'>
</span><span class='line'>  return {
</span><span class='line'>    x: x,
</span><span class='line'>    y: y
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>//Modified this to use the AnimatedShape we create up above. Thanks Facebook :)
</span><span class='line'>
</span><span class='line'>/**
</span><span class='line'> * Copyright 2013-2014 Facebook, Inc.
</span><span class='line'> * All rights reserved.
</span><span class='line'> *
</span><span class='line'> * This source code is licensed under the BSD-style license found in the
</span><span class='line'> * LICENSE file in the root directory of this source tree. An additional grant
</span><span class='line'> * of patent rights can be found in the PATENTS file in the same directory.
</span><span class='line'> *
</span><span class='line'> * @providesModule Circle.art
</span><span class='line'> * @typechecks
</span><span class='line'> *
</span><span class='line'> * Example usage:
</span><span class='line'> * &lt;Circle
</span><span class='line'> *   radius={10}
</span><span class='line'> *   stroke="green"
</span><span class='line'> *   strokeWidth={3}
</span><span class='line'> *   fill="blue"
</span><span class='line'> * /&gt;
</span><span class='line'> *
</span><span class='line'> */
</span><span class='line'>var AnimatedCircle = React.createClass({displayName: "Circle",
</span><span class='line'>  render: function() {
</span><span class='line'>    var radius = this.props.radius;
</span><span class='line'>
</span><span class='line'>    var path = Path().moveTo(0, -radius)
</span><span class='line'>        .arc(0, radius * 2, radius)
</span><span class='line'>        .arc(0, radius * -2, radius)
</span><span class='line'>        .close();
</span><span class='line'>    return React.createElement(AnimatedShape, React.__spread({},  this.props, {d: path}));
</span><span class='line'>  }
</span><span class='line'>});
</span><span class='line'>
</span><span class='line'>AppRegistry.registerComponent('FireworkShooter', () =&gt; FireworkShooter);</span></code></pre></td></tr></table></div></figure>

</div>
        
	</div>
	<div>
    	


		



  
		
			Tagged under
		
    <a class='category' href='/blog/categories/animated/'>animated</a>, <a class='category' href='/blog/categories/animations/'>animations</a>, <a class='category' href='/blog/categories/firework/'>firework</a>, <a class='category' href='/blog/categories/react/'>react</a>, <a class='category' href='/blog/categories/react-art/'>react-art</a>, <a class='category' href='/blog/categories/react-native/'>react-native</a>, <a class='category' href='/blog/categories/shooter/'>shooter</a>, <a class='category' href='/blog/categories/tap/'>tap</a>
	


    	
	</div>
	
</article>
<!-- END OF _includes/article.html -->


<footer style="margin-top: 10px;">
    <div id="post-author">
	<div class="post-author-content" style="width: 70%; display: inline-block;">
		<p style="font-size: 16px;">
			If you ever want further explanation, want to see a particular type of tutorial, or to contact me for whatever reason you can drop me a line on twitter <a href="http://twitter.com/browniefed">@browniefed</a> or email me at <a href="mailto:browniefed@gmail.com">browniefed@gmail.com</a>
		</p>
	</div>
</div>
</footer>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>


<!-- END OF _/layouts/post.html -->

		
			<footer>
				Copyright &copy; 2015

	Jason Brown


			</footer>
			
		</div> <!-- // .wrap -->
          

<script type="text/javascript">
      var disqus_shortname = 'browniefedblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://browniefed.com/blog/2015/08/29/react-native-animated-with-react-art-firework-show/';
        var disqus_url = 'http://browniefed.com/blog/2015/08/29/react-native-animated-with-react-art-firework-show/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


	</body>
	<script>
		$(document).ready(function() {
			// Make images center
			$('p:has(img)').css('text-align', 'center');
			
			// Add the image's title attribute as a caption
			$('p:has(img)').append(function () {
				return '<div class="caption">' + $('img', this).attr('title') + '</div>';
			});
			
			// Prettify code
			$('code').addClass('prettyprint');
			$('pre code').addClass('linenums');
			
			// Copy to clipboard with button
			$('pre:has(code)').prepend(function(){
				return '<div class="clip-btn">copy to clipboard</div>';
			});
			$('.clip-btn').zclip({
				path:'/js/ZeroClipboard.swf',
				copy: $(this).next('code').text(),
				afterCopy: function(){
					$(this).replaceWith('<div class="clip-btn">copied!');
					}
			});
		});
	</script>
    

<script type="text/javascript">
      var disqus_shortname = 'browniefedblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://browniefed.com/blog/2015/08/29/react-native-animated-with-react-art-firework-show/';
        var disqus_url = 'http://browniefed.com/blog/2015/08/29/react-native-animated-with-react-art-firework-show/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


</html>
<!-- END OF _layouts/default.html -->
